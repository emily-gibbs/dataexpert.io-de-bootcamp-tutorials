#!/bin/bash
set -eux

# Initialize PostgreSQL data directory if it doesnâ€™t exist
PGDATA=${PGDATA:-/home/jovyan/srv/pgsql}
if [ ! -d "$PGDATA" ]; then
  initdb -D "$PGDATA" --auth-host=md5 --encoding=UTF8
fi

# Start PostgreSQL
pg_ctl -D "$PGDATA" -l "$PGDATA/pg.log" start

# Load environment variables from .env
set -o allexport
source bootcamp/materials/class1/.env
set +o allexport

# Run the init-db.sh script
echo "Running init-db.sh script..."
chmod +x bootcamp/materials/1-dimensional-data-modeling/scripts/init-db.sh
bash bootcamp/materials/1-dimensional-data-modeling/scripts/init-db.sh